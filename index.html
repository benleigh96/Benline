<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Benline</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/diff-match-patch@1.0.5/index.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background-color: #f9f9f9;
    }

    header {
      background-color: #fff;
      padding: 1rem;
      text-align: center;
      font-size: 2rem;
    }

    .red {
      color: red;
      text-decoration: line-through;
    }

    .blue {
      color: blue;
      text-decoration: underline;
    }

    .black {
      color: black;
    }

    .label-container {
      display: flex;
      font-size: 0.85rem;
      color: #666;
      background-color: #fff;
      padding: 0.5rem 1rem 0 1rem;
    }

    .label-container div {
      flex: 1;
      text-align: center;
      position: relative;
    }

    .container {
      display: flex;
      height: calc(100vh - 160px);
      padding: 0 1rem 1rem 1rem;
      box-sizing: border-box;
    }

    textarea, .output {
      flex: 1;
      padding: 1rem;
      font-size: 11px;
      line-height: 1.5;
      border: none;
      resize: none;
      outline: none;
      font-family: 'Inter', monospace;
      overflow-wrap: break-word;
      white-space: pre-wrap;
      background-color: #fff;
      border-right: 1px solid #ddd;
      box-sizing: border-box;
      overflow-y: auto;
    }

    .output {
      border-right: none;
      overflow-x: hidden;
    }

    .output-wrapper {
      flex: 1;
      position: relative;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    #copy-button {
      position: absolute;
      top: -1.5rem;
      right: 0.5rem;
      font-size: 0.75rem;
      padding: 2px 6px;
      background-color: #eee;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
    }

    #copy-button:hover {
      background-color: #ddd;
    }

    footer {
      text-align: center;
      padding: 0.75rem;
      font-size: 0.85rem;
      color: #666;
      background-color: #fff;
      border-top: 1px solid #eee;
    }

    .privacy-link {
      cursor: pointer;
      text-decoration: underline;
      color: inherit;
      font-family: 'Inter', sans-serif;
    }

    #privacy-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 420px;
      width: 90%;
      padding: 1rem 1.25rem;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      display: none;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    #privacy-popup p {
      margin: 0 0 1rem 0;
    }

    #privacy-popup .close {
      position: absolute;
      top: 6px;
      right: 10px;
      font-size: 16px;
      cursor: pointer;
      color: #888;
    }

    #privacy-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.3);
      z-index: 999;
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <span class="red">Red</span><span class="blue">Ben</span><span class="black">line</span>
  </header>

  <div class="label-container">
    <div>Original</div>
    <div>Modified</div>
    <div>
      Benline
      <button id="copy-button">Copy</button>
    </div>
  </div>

  <div class="container">
    <textarea id="original" placeholder="Original text..."></textarea>
    <textarea id="modified" placeholder="Modified text..."></textarea>
    <div class="output-wrapper">
      <div class="output" id="output"></div>
    </div>
  </div>

  <footer>
    <span class="privacy-link" onclick="showPrivacy()">Privacy</span>
  </footer>

  <div id="privacy-overlay"></div>
  <div id="privacy-popup">
    <span class="close" onclick="hidePrivacy()">√ó</span>
    <p><em>This page is static and runs entirely in your browser. Text typed into the Original or Modified boxes is not sent anywhere. The ‚ÄúCopy‚Äù button simply copies the content to your own clipboard. Nothing is logged, stored, tracked, or uploaded. Benline away...</em></p>
  </div>

  <script>
    const originalBox = document.getElementById("original");
    const modifiedBox = document.getElementById("modified");
    const outputBox = document.getElementById("output");
    const copyButton = document.getElementById("copy-button");

    function escapeHTML(str) {
      return str.replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;");
    }

    function generateDiff() {
      if (typeof diff_match_patch === "undefined") {
        outputBox.innerHTML = '<div style="color: red;">Diff engine failed to load.</div>';
        return;
      }

      const dmp = new diff_match_patch();
      dmp.Diff_EditCost = 4;

      const original = originalBox.value;
      const modified = modifiedBox.value;

      if (original === modified) {
        outputBox.innerHTML = `
          <div style="text-align:center; color:#888; font-style:italic;">These texts are identical</div>
          <div style="text-align:center; font-size:20px;">üëå</div>
        `;
        return;
      }

      const diffs = dmp.diff_main(original, modified);
      dmp.diff_cleanupEfficiency(diffs);

      let result = '';
      for (const [op, data] of diffs) {
        const safe = escapeHTML(data);
        if (op === 0) result += `<span class="black">${safe}</span>`;
        else if (op === -1) result += `<span class="red">${safe}</span>`;
        else if (op === 1) result += `<span class="blue">${safe}</span>`;
      }

      outputBox.innerHTML = result;
    }

    originalBox.addEventListener("input", generateDiff);
    modifiedBox.addEventListener("input", generateDiff);

    copyButton.addEventListener("click", () => {
      const range = document.createRange();
      range.selectNodeContents(outputBox);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);

      try {
        const successful = document.execCommand("copy");
        if (successful) {
          copyButton.innerText = "Copied!";
          setTimeout(() => copyButton.innerText = "Copy", 1000);
        } else {
          alert("Copy failed. Try selecting manually.");
        }
      } catch (err) {
        console.error("Copy command failed:", err);
        alert("Copy not supported. Try selecting manually.");
      }

      selection.removeAllRanges();
    });

    function showPrivacy() {
      document.getElementById("privacy-popup").style.display = "block";
      document.getElementById("privacy-overlay").style.display = "block";
    }

    function hidePrivacy() {
      document.getElementById("privacy-popup").style.display = "none";
      document.getElementById("privacy-overlay").style.display = "none";
    }
  </script>
</body>
</html>
